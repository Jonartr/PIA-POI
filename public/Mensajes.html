<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">   
</head>
<body >
    <section class="flex h-screen overflow-hidden">
        <!--Sesion del header y zona de chats-->
        <div class="bg-white xl:w-3/12 lg:w-4/12 w-full p-6">
            <h3 class="text-2xl mb-8">Chat en l√≠nea</h3>
            <!--Estatus de las personas en linea--> <!--Estatus de las personas en linea-->
            <div class="flex overflow-auto w-full mb-8">
                <div class="mr-4 text-center self-center">
                    <div class="relative w-12 mb-2">
                        <img src="img/user-01.jpg" class="rounded-full">
                        <div class="absolute bg-green-300 p-1 rounded-full bottom-0 right-0 border-2 border-gray-800"></div>
                    </div>
                    <small>Zenitsu</small>
                </div>
                <div class="mr-4 text-center self-center">
                    <div class="relative w-12 mb-2">
                        <img src="img/user-02.jpg" class="rounded-full">
                        <div class="absolute bg-red-300 p-1 rounded-full bottom-0 right-0 border-2 border-gray-800"></div>
                    </div>
                    <small>Bocchi</small>
                </div>
                
            </div>
             <!--Estatus de las personas en linea--> <!--Estatus de las personas en linea-->


             <!--Header de ultimos mensajes enviados--><!--Header de ultimos mensajes enviados-->
            <div class="flex bg-gray-100 mb-4 p-4 rounded">
                <img src="img/user-01.jpg" class="self-start rounded-full w-12 mr-4">
                <div class="w-full overflow-hidden">
                    <div class="flex mb-1">
                        <p class="font-medium flex-grow">Zenitsu Agatsuma</p>
                        <small class="text-gray-500">09:55 am</small>
                    </div>
                    <small class="overflow-ellipsis overflow-hidden block whitespace-nowrap text-gray-500">Hola</small>
                </div>
            </div>

            <div class="flex bg-gray-100 mb-4 p-4 rounded" onclick="">
                <img src="img/user-02.jpg" class="self-start rounded-full w-12 mr-4">
                <div class="w-full overflow-hidden">
                    <div class="flex mb-1">
                        <p class="font-medium flex-grow">Bocchi Gotou, Zenitsu Agatsuma </p>
                        <small class="text-gray-500">09:55 am</small>
                    </div>
                    <small class="overflow-ellipsis overflow-hidden block whitespace-nowrap text-gray-500">Hola</small>
                </div>
            </div>
            <!--Header de ultimos mensajes enviados--><!--Header de ultimos mensajes enviados-->
            
        </div>
        <div class="bg-gray-100 xl:w-9/12 lg:w-8/12 hidden lg:block">

            <!--Header ventana del chat--><!--Header ventana del chat--><!--Header ventana del chat-->
            <div class="py-6 px-20 border-b">
                <div class="flex">
                    <div class="flex flex-grow">
                        <div class="relative mr-4">
                            <img src="img/user-02.jpg" class="rounded-full w-12">
                            <div class="absolute bg-red-300 p-1 rounded-full bottom-0 right-0 border-2 border-gray-800"></div>
                        </div>
                        <div>
                            <p class="font-medium">Hitori Bocchi</p> <!--Usuario con el que se chatea-->
                            <small class="text-gray-500">Online</small> <!--Status-->
                        </div>
                    </div>
                    <div class="flex">
                        <svg class="w-6 mr-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        <svg class="w-6 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                        </svg>
                    </div>
                </div>
            </div>
            <!--Header ventana del chat--><!--Header ventana del chat--><!--Header ventana del chat--><!--Header ventana del chat-->
            <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->
            <div class="chats" id = "msj_chat">


            </div>
              <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->  <!--Chat-->
            <!--Linea para mensajes y archivos de texto--> <!--Linea para mensajes y archivos de texto--> <!--Linea para mensajes y archivos de texto--> 
            <div class="flex py-6 px-20 border-t">
                <div class="w-4/5">
                    <input type="text" id= "msj" class="rounded-sm px-4 py-2 focus:outline-none bg-gray-100 w-full" placeholder="Escribe tu mensaje..."> 
                </div>
                <div class="w-1/5 flex justify-end">
                    <svg class="w-6 mr-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                    </svg>
                    <svg class="w-6 mr-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                   
                    <input href="" type = "submit" class="bg-blue-500 text-white rounded px-4 py-2" id = "Enviar"></a>
                    
                </div>
            </div>
            <!--Linea para mensajes y archivos de texto--> <!--Linea para mensajes y archivos de texto--> <!--Linea para mensajes y archivos de texto--> 
        </div>
    </section> 

    <!--Conexion con firebase--> <!--Conexion con firebase--> <!--Conexion con firebase--> <!--Conexion con firebase--> <!--Conexion con firebase-->
 
    <script type="module">
      
        // Import the functions you need from the SDKs you need
          import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
          import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-analytics.js";
          // TODO: Add SDKs for Firebase products that you want to use
          // https://firebase.google.com/docs/web/setup#available-libraries
  
          // Your web app's Firebase configuration
          // For Firebase JS SDK v7.20.0 and later, measurementId is optional
          const firebaseConfig = {
              apiKey: "AIzaSyBMMI7fGG_UEEkZ537X7efvhemElAGNvV4",
              authDomain: "mensajeria-poi.firebaseapp.com",
              databaseURL: "https://mensajeria-poi-default-rtdb.firebaseio.com",
              projectId: "mensajeria-poi",
              storageBucket: "mensajeria-poi.appspot.com",
              messagingSenderId: "840989306295",
              appId: "1:840989306295:web:2192e5056c57cf85ef4c32",
              measurementId: "G-2RH39H1T41"
          };
  
          // Initialize Firebase
          const app = initializeApp(firebaseConfig);
          const analytics = getAnalytics(app);
  
          import { getDatabase, ref, set,get, child, update, remove, push, onChildAdded} 
          from  "https://www.gstatic.com/firebasejs/9.20.0/firebase-database.js";
  
              const db = getDatabase();

            //Mostrar mensajes

            var grupal = false;
              var enviar_msj = document.getElementById('Enviar');
              var mensaje_txt = document.getElementById('msj');
              var date = new Date().toUTCString();

            function cargar_mensajes(){
                const refmensajes = ref(db,"Mensajes");

            if(grupal == true){
                    onChildAdded(refmensajes,(data)=>{
                    if(data.val().Usuario_emisor == "Joesnah" ){
                        var msje_view = data.val().Mensaje;
                        var msj_emisor ='<div class="flex flex-row-reverse mb-12">\n' +
                    '<img src="img/user-01.jpg" class="self-end rounded-full w-12 ml-4">\n' +
                    '<div class="flex flex-col">\n'+
                    '<div class="bg-blue-500 text-white p-6 rounded-3xl rounded-br-none w-96 mb-2">\n'+
                     ' <p class="font-medium mb-1">'+data.val().Usuario_emisor+'</p>\n'+
                            '<small class="inline-block mb-1">'+msje_view +'</small>\n'+
                        '</div>\n'
                        '<small class="text-gray-500 self-end">'+ data.val().Fecha_envio+'</small>\n'
                    '</div>\n'
                '</div>\n';
                var data_msj = document.getElementById('msj_chat');
                data_msj.insertAdjacentHTML('beforebegin',msj_emisor);
                

                }
                else{
                    var msje_view = data.val().Mensaje;
                        var msj_remitenten ='<div class="flex mb-12\n' +
                    '<img src="img/user-01.jpg" class="self-end rounded-full w-12 mr-4">\n' +
                    '<div class="flex flex-col">\n'+
                    ' <div class="bg-white p-6 rounded-3xl rounded-bl-none w-96 shadow-sm mb-2">\n'+
                     ' <p class="font-medium mb-1">'+data.val().Usuario_emisor+'</p>\n'+
                            '<small class="inline-block mb-1">'+msje_view +'</small>\n'+
                        '</div>\n'
                        '<small class="text-gray-500 self-end">'+ data.val().Fecha_envio+'</small>\n'
                    '</div>\n'
                '</div>\n';
                var data_msj = document.getElementById('msj_chat');
                data_msj.insertAdjacentHTML('beforebegin',msj_remitenten);
                }
               
                 });

            }
            else{

                onChildAdded(refmensajes,(data)=>{
                    if(data.val().Usuario_emisor == "Joesnah"){
                        var msje_view = data.val().Mensaje;
                        var msj_emisor ='<div class="flex flex-row-reverse mb-12">\n' +
                    '<img src="img/user-01.jpg" class="self-end rounded-full w-12 ml-4">\n' +
                    '<div class="flex flex-col">\n'+
                    '<div class="bg-blue-500 text-white p-6 rounded-3xl rounded-br-none w-96 mb-2">\n'+
                     ' <p class="font-medium mb-1">'+data.val().Usuario_emisor+'</p>\n'+
                            '<small class="inline-block mb-1">'+msje_view +'</small>\n'+
                        '</div>\n'
                        '<small class="text-gray-500 self-end">'+ data.val().Fecha_envio+'</small>\n'
                    '</div>\n'
                '</div>\n';
                var data_msj = document.getElementById('msj_chat');
                data_msj.insertAdjacentHTML('beforebegin',msj_emisor);
                

                }
                else{
                    if(data.val().Usuario_emisor == "Skadi"){
                        var msje_view = data.val().Mensaje;
                        var msj_remitenten ='<div class="flex mb-12\n' +
                    '<img src="img/user-01.jpg" class="self-end rounded-full w-12 mr-4">\n' +
                    '<div class="flex flex-col">\n'+
                    ' <div class="bg-white p-6 rounded-3xl rounded-bl-none w-96 shadow-sm mb-2">\n'+
                     ' <p class="font-medium mb-1">'+data.val().Usuario_emisor+'</p>\n'+
                            '<small class="inline-block mb-1">'+msje_view +'</small>\n'+
                        '</div>\n'
                        '<small class="text-gray-500 self-end">'+ data.val().Fecha_envio+'</small>\n'
                    '</div>\n'
                '</div>\n';
                var data_msj = document.getElementById('msj_chat');
                data_msj.insertAdjacentHTML('beforebegin',msj_remitenten);
                    }
                  
                }
               
                 });
            }
              

              

            }


              function enviar_mensaje(){
                if (grupal == true){
                    push(ref(db,"Mensajes"),{
                    
                    Mensaje: mensaje_txt.value,
                    Usuario_remitente: "Geno",
                    Usuario_remitente2:"Skadi",
                    Usuario_emisor: "Joesnah",
                    Fecha_envio: date,
                    ID_Emisor: 1,
                    ID_Remitente: 2

                     })
                    .then(()=>{alert("Guardado con exito");})
                    .catch((error)=>{alert("Fallo al guardar en la bases");});
                    return true;    
                }
                else{
                    push(ref(db,"Mensajes"),{
                    
                    Mensaje: mensaje_txt.value,
                    Usuario_remitente: "Joesnah",
                    Usuario_emisor: "Geno",
                    Fecha_envio: date,
                    ID_Emisor: 1,
                    ID_Remitente: 2

                     })
                    .then(()=>{alert("Guardado con exito");})
                    .catch((error)=>{alert("Fallo al guardar en la bases");});
                    return true;    
                }
               
              }
             
              enviar_msj.addEventListener("click", enviar_mensaje)
              window.onload=cargar_mensajes;

        </script>
         <!--Conexion con firebase--> <!--Conexion con firebase--> <!--Conexion con firebase--> <!--Conexion con firebase--> <!--Conexion con firebase-->s


</body >
</html>